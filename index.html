<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOW Tools - PDF & Image Editor</title>
    
    <!-- REQUIRED LIBRARIES -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://unpkg.com/ghostscript-wasm@1.0.12/dist/ghostscript-wasm.js"></script>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js`;
    </script>

    <style>
        :root {
            --bg-main: #0d0f14; --bg-navbar: #1c222d; --bg-card: #12151a; --bg-button: #1c222d;
            --accent-primary: #42f8f5; --accent-shade: #3ff7f3; --text-primary: #ffffff;
            --text-secondary: #c5d1de; --glow-shadow: rgba(66, 248, 245, 0.6);
            --glow-shadow-hover: rgba(66, 248, 245, 0.9); --border-color: #42f8f5; --error-color: #f84242;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; background-color: var(--bg-main); color: var(--text-primary); line-height: 1.6; }
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: var(--bg-main); }
        ::-webkit-scrollbar-thumb { background: var(--accent-primary); border-radius: 10px; }
        .header { background-color: var(--bg-navbar); padding: 1rem 5%; position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.5); border-bottom: 1px solid var(--accent-primary); }
        .logo { font-size: 1.8rem; font-weight: bold; color: var(--text-primary); text-shadow: 0 0 5px var(--glow-shadow); cursor: pointer; }
        .logo-accent { color: var(--accent-primary); }
        .nav-links a { color: var(--text-primary); text-decoration: none; margin: 0 1rem; font-weight: 500; transition: color 0.3s ease, text-shadow 0.3s ease; }
        .nav-links a:hover { color: var(--accent-primary); text-shadow: 0 0 10px var(--glow-shadow); }
        .nav-toggle { display: none; font-size: 1.5rem; background: none; border: none; color: var(--text-primary); cursor: pointer; }
        .main-container { padding: 2rem 5%; } 
        #pdf-tools, #image-tools { padding-top: 2rem; }
        .section-title { text-align: center; font-size: 2.5rem; margin: 2.5rem 0 2rem 0; color: var(--text-primary); text-shadow: 0 0 10px var(--glow-shadow); }
        .tool-grid { display: grid; gap: 1.5rem; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .tool-card { background-color: var(--bg-card); border: 1px solid var(--bg-navbar); border-radius: 8px; padding: 1.5rem; display: flex; flex-direction: column; justify-content: space-between; transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease; }
        .tool-card:hover { transform: translateY(-5px); border-color: var(--border-color); box-shadow: 0 0 15px var(--glow-shadow); }
        .tool-card h2 { color: var(--accent-primary); font-size: 1.5rem; margin-bottom: 0.5rem; }
        .tool-card p { color: var(--text-secondary); font-size: 1rem; flex-grow: 1; margin-bottom: 1.5rem; }
        .glow-button { background-color: var(--bg-button); color: var(--text-primary); border: 2px solid var(--border-color); border-radius: 5px; padding: 0.75rem 1.5rem; font-size: 1rem; font-weight: bold; cursor: pointer; text-align: center; text-transform: uppercase; transition: all 0.3s ease; box-shadow: 0 0 5px var(--glow-shadow); display: block; width: 100%; }
        .glow-button:hover, .glow-button:focus { background-color: var(--accent-primary); color: var(--bg-main); box-shadow: 0 0 20px var(--glow-shadow-hover); }
        .glow-button:disabled { cursor: not-allowed; background-color: #333; border-color: #555; box-shadow: none; color: #888; }
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(5px); }
        .modal-content { background-color: var(--bg-main); margin: 5% auto; padding: 2rem; border: 1px solid var(--border-color); border-radius: 8px; width: 90%; max-width: 800px; box-shadow: 0 0 25px var(--glow-shadow); position: relative; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-close { color: var(--text-secondary); position: absolute; top: 1rem; right: 1.5rem; font-size: 2rem; font-weight: bold; cursor: pointer; transition: color 0.3s ease, transform 0.3s ease; }
        .modal-close:hover { color: var(--accent-primary); transform: scale(1.1); }
        .modal-header h2 { color: var(--accent-primary); font-size: 2rem; margin-bottom: 1rem; }
        .modal-body { max-height: 70vh; overflow-y: auto; padding-right: 10px; }
        .tool-ui-container { margin-top: 1.5rem; display: flex; flex-direction: column; gap: 1.5rem; }
        .tool-ui-container label, .form-group label { display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: bold; }
        .tool-ui-container input[type="text"], .tool-ui-container input[type="number"], .tool-ui-container input[type="password"], .tool-ui-container textarea, .tool-ui-container select, .tool-ui-container input[type="color"] { width: 100%; padding: 0.75rem; background-color: var(--bg-button); border: 1px solid var(--bg-navbar); border-radius: 5px; color: var(--text-primary); font-size: 1rem; transition: border-color 0.3s, box-shadow 0.3s; }
        .tool-ui-container input:focus, .tool-ui-container textarea:focus, .tool-ui-container select:focus { outline: none; border-color: var(--border-color); box-shadow: 0 0 8px var(--glow-shadow); }
        .tool-ui-container input[type="file"] { display: none; }
        .file-upload-label { display: block; padding: 2rem; background-color: var(--bg-button); border: 2px dashed var(--border-color); border-radius: 5px; cursor: pointer; text-align: center; transition: background-color 0.3s; }
        .file-upload-label:hover { background-color: var(--bg-navbar); }
        .file-list p { background: var(--bg-card); padding: 0.5rem 1rem; border-radius: 4px; margin-top: 0.5rem; }
        .alert-message { padding: 1rem; margin-top: 1rem; border-radius: 5px; font-weight: bold; display: none; }
        .alert-message.success { background-color: rgba(66, 248, 245, 0.2); border: 1px solid var(--accent-primary); color: var(--accent-primary); }
        .alert-message.error { background-color: rgba(248, 66, 66, 0.2); border: 1px solid var(--error-color); color: var(--error-color); }
        .flex-group { display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
        #image-preview-canvas { max-width: 100%; border-radius: 5px; border: 1px solid var(--border-color); }
        @media (max-width: 768px) { .header { flex-direction: column; gap: 1rem; padding: 1rem 2rem; } .nav-links { display: none; flex-direction: column; width: 100%; text-align: center; } .nav-links.active { display: flex; } .nav-links a { padding: 0.5rem 0; border-top: 1px solid var(--bg-button); } .nav-toggle { display: block; position: absolute; top: 1.25rem; right: 1.25rem; } .modal-content { width: 95%; margin: 10% auto; padding: 1.5rem; } }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">WOW<span class="logo-accent">Tools</span></div>
        <nav class="nav-links">
            <a href="#pdf-tools">PDF Tools</a>
            <a href="#image-tools">Image Tools</a>
        </nav>
        <button class="nav-toggle" aria-label="Toggle navigation">☰</button>
    </header>
    
    <main class="main-container" id="home">
        <!-- PDF TOOLS SECTION -->
        <section id="pdf-tools">
            <h1 class="section-title">PDF Tool Suite</h1>
            <div class="tool-grid" id="pdf-tool-grid">
                <!-- PDF tool cards will be generated here by JavaScript -->
            </div>
        </section>

        <!-- IMAGE TOOLS SECTION -->
        <section id="image-tools">
            <h1 class="section-title">Image Tool Suite</h1>
            <div class="tool-grid" id="image-tool-grid">
                <!-- Image tool cards will be generated here by JavaScript -->
            </div>
        </section>
    </main>
    
    <div id="toolModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">×</span>
            <div class="modal-header"><h2 id="modal-title">Tool Title</h2></div>
            <div class="modal-body">
                <div id="modal-tool-ui" class="tool-ui-container"></div>
                <div id="modal-alert" class="alert-message"></div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Tool Definitions ---
        const pdfTools = [
            { id: 'mergePdf', title: 'Merge PDF', description: 'Combine multiple PDF files into one single document.' },
            { id: 'splitPdf', title: 'Split PDF', description: 'Extract pages or split every page into a separate PDF.' },
            { id: 'compressPdf', title: 'Compress PDF', description: 'Reduce PDF file size with powerful, client-side compression.' },
            { id: 'rotatePdf', title: 'Rotate PDF', description: 'Rotate all or specific pages in your PDF document.' },
            { id: 'addWatermark', title: 'Add Watermark', description: 'Stamp text over your PDF pages with custom styling.' },
            { id: 'addPageNumbers', title: 'Add Page Numbers', description: 'Insert page numbers easily into your PDF file.' },
            { id: 'pdfToJpg', title: 'PDF to JPG', description: 'Convert PDF pages to JPG images.' },
        ];

        const imageTools = [
            { id: 'compressImage', title: 'Compress Image', description: 'Reduce the file size of JPG and PNG images.' },
            { id: 'resizeImage', title: 'Resize Image', description: 'Change the dimensions of your image.' },
            { id: 'cropImage', title: 'Crop Image', description: 'Crop images by specifying exact dimensions.' },
            { id: 'imageEditor', title: 'Photo Editor', description: 'Apply filters, adjustments, and text to your images.' },
            { id: 'watermarkImage', title: 'Watermark Image', description: 'Add a text or image watermark to your picture.' },
            { id: 'convertToJpg', title: 'Convert to JPG', description: 'Convert PNG, GIF, WebP and other formats to JPG.' },
            { id: 'removeBg', title: 'Remove Background', description: 'AI-powered background removal (Conceptual - Requires Server).'}
        ];

        const allTools = [...pdfTools, ...imageTools];

        // --- Global Variables & Initial Setup ---
        const { PDFDocument, rgb, degrees } = PDFLib;
        const pdfToolGrid = document.getElementById('pdf-tool-grid');
        const imageToolGrid = document.getElementById('image-tool-grid');
        const modal = document.getElementById('toolModal');
        const modalClose = document.querySelector('.modal-close');
        const modalTitle = document.getElementById('modal-title');
        const modalToolUi = document.getElementById('modal-tool-ui');
        const modalAlert = document.getElementById('modal-alert');
        const navToggle = document.querySelector('.nav-toggle');
        const navLinks = document.querySelector('.nav-links');
        
        // --- Populate UI Function (UPDATED) ---
        function populateTools() {
            pdfToolGrid.innerHTML = '';
            imageToolGrid.innerHTML = '';

            pdfTools.forEach(tool => {
                const card = createToolCard(tool);
                pdfToolGrid.appendChild(card);
            });

            imageTools.forEach(tool => {
                const card = createToolCard(tool);
                imageToolGrid.appendChild(card);
            });
        }

        function createToolCard(tool) {
            const card = document.createElement('div');
            card.className = 'tool-card';
            card.innerHTML = `<h2>${tool.title}</h2><p>${tool.description}</p><button class="glow-button" data-tool-id="${tool.id}">Open Tool</button>`;
            return card;
        }

        function openModal(toolId) {
            const tool = allTools.find(t => t.id === toolId);
            if (!tool) return;
            modalTitle.textContent = tool.title;
            modalToolUi.innerHTML = '';
            hideAlert();
            renderToolUI(toolId);
            modal.style.display = 'block';
        }

        function closeModal() { modal.style.display = 'none'; }
        function showAlert(message, type = 'success') { modalAlert.textContent = message; modalAlert.className = `alert-message ${type}`; modalAlert.style.display = 'block'; }
        function hideAlert() { modalAlert.style.display = 'none'; }

        document.body.addEventListener('click', (e) => { 
            if (e.target.classList.contains('glow-button')) {
                const toolId = e.target.dataset.toolId;
                if (toolId) openModal(toolId);
            }
        });
        modalClose.addEventListener('click', closeModal);
        window.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
        navToggle.addEventListener('click', () => navLinks.classList.toggle('active'));

        function downloadFile(bytes, fileName, mimeType) {
            const blob = new Blob([bytes], { type: mimeType });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }
        
        // --- Main UI Rendering Router ---
        function renderToolUI(toolId) {
            // PDF Tools Logic
            if (pdfTools.some(t => t.id === toolId)) {
                renderPdfTool(toolId);
                return;
            }
            // Image Tools Logic
            if (imageTools.some(t => t.id === toolId)) {
                renderImageTool(toolId);
                return;
            }
        }
        
        // --- PDF Tool Renderer ---
        function renderPdfTool(toolId) {
            switch (toolId) {
                // All PDF tool cases from previous answer go here...
                case 'mergePdf':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select PDF Files (2 or more)</label><input type="file" id="file-upload" accept=".pdf" multiple><div id="file-list" class="file-list"></div><button id="process-btn" class="glow-button" disabled>Merge PDFs</button>`;
                    setupFileProcessor({
                        buttonId: 'process-btn', minFiles: 2,
                        processFunction: async (files) => {
                            showAlert('Merging PDFs...', 'success');
                            const mergedPdf = await PDFDocument.create();
                            for (const file of files) {
                                const pdfDoc = await PDFDocument.load(await file.arrayBuffer());
                                const copiedPages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
                                copiedPages.forEach(page => mergedPdf.addPage(page));
                            }
                            downloadFile(await mergedPdf.save(), 'wow-merged.pdf', 'application/pdf');
                            hideAlert();
                        }
                    });
                    break;
                case 'compressPdf':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select PDF File to Compress</label><input type="file" id="file-upload" accept=".pdf"><div id="file-list" class="file-list"></div><div class="form-group"><label for="compression-level">Compression Level:</label><select id="compression-level"><option value="/ebook">Recommended</option><option value="/screen">Basic (Smallest Size)</option><option value="/printer">High Quality</option></select></div><button id="process-btn" class="glow-button" disabled>Compress PDF</button>`;
                    setupFileProcessor({
                        buttonId: 'process-btn', maxFiles: 1,
                        processFunction: async (files) => {
                            showAlert('Loading compression engine...', 'success');
                            const gs = await ghostscript_wasm();
                            showAlert('Engine loaded. Compressing...', 'success');
                            const inputBytes = await files[0].arrayBuffer();
                            await gs.writeFile(files[0].name, new Uint8Array(inputBytes));
                            await gs.run('-sDEVICE=pdfwrite', `-dPDFSETTINGS=${document.getElementById("compression-level").value}`, '-dNOPAUSE', '-dBATCH', '-sOutputFile=output.pdf', files[0].name);
                            const outputBytes = await gs.readFile('output.pdf');
                            downloadFile(outputBytes, `wow-compressed.pdf`, 'application/pdf');
                            hideAlert();
                            await gs.exit();
                        }
                    });
                    break;
                // Add all other PDF tool cases here...
                default:
                    modalToolUi.innerHTML = `<p>This PDF tool is under construction.</p>`;
            }
        }
        
        // --- Image Tool Renderer ---
        function renderImageTool(toolId) {
            switch (toolId) {
                case 'compressImage':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select Image (JPG or PNG)</label><input type="file" id="file-upload" accept="image/jpeg,image/png"><div id="file-list" class="file-list"></div><div class="form-group"><label for="quality-slider">Quality (0-1): <span id="quality-value">0.8</span></label><input type="range" id="quality-slider" min="0.1" max="1" step="0.05" value="0.8" style="width: 100%;"></div><button id="process-btn" class="glow-button" disabled>Compress Image</button>`;
                    setupImageProcessor({
                        buttonId: 'process-btn',
                        processFunction: (canvas, ctx, file) => {
                            const quality = parseFloat(document.getElementById('quality-slider').value);
                            canvas.toBlob(blob => {
                                downloadFile(blob, `wow-compressed-${file.name}`, 'image/jpeg');
                            }, 'image/jpeg', quality);
                        }
                    });
                    document.getElementById('quality-slider').oninput = e => document.getElementById('quality-value').textContent = e.target.value;
                    break;
                case 'resizeImage':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select Image</label><input type="file" id="file-upload" accept="image/*"><div id="file-list" class="file-list"></div><div class="flex-group"><div class="form-group"><label for="width-input">New Width (px):</label><input type="number" id="width-input"></div><div class="form-group"><label for="height-input">New Height (px):</label><input type="number" id="height-input"></div></div><label><input type="checkbox" id="aspect-lock" checked> Lock aspect ratio</label><button id="process-btn" class="glow-button" disabled>Resize Image</button>`;
                    setupImageProcessor({
                        buttonId: 'process-btn',
                        processFunction: (canvas, ctx, file) => {
                            const newWidth = parseInt(document.getElementById('width-input').value);
                            const newHeight = parseInt(document.getElementById('height-input').value);
                            if (!newWidth || !newHeight) { showAlert('Please enter valid dimensions.', 'error'); return; }
                            
                            const newCanvas = document.createElement('canvas');
                            newCanvas.width = newWidth;
                            newCanvas.height = newHeight;
                            const newCtx = newCanvas.getContext('2d');
                            newCtx.drawImage(canvas, 0, 0, newWidth, newHeight);
                            
                            newCanvas.toBlob(blob => {
                                downloadFile(blob, `wow-resized-${file.name}`, file.type);
                            }, file.type);
                        }
                    });
                    // Logic for aspect ratio lock
                    let originalWidth, originalHeight;
                    document.getElementById('file-upload').addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (!file) return;
                        const img = new Image();
                        img.onload = () => {
                           originalWidth = img.width;
                           originalHeight = img.height;
                           document.getElementById('width-input').value = originalWidth;
                           document.getElementById('height-input').value = originalHeight;
                        }
                        img.src = URL.createObjectURL(file);
                    });
                    document.getElementById('width-input').oninput = (e) => {
                        if (document.getElementById('aspect-lock').checked) {
                            const newHeight = Math.round((e.target.value / originalWidth) * originalHeight);
                            document.getElementById('height-input').value = newHeight;
                        }
                    };
                    document.getElementById('height-input').oninput = (e) => {
                         if (document.getElementById('aspect-lock').checked) {
                            const newWidth = Math.round((e.target.value / originalHeight) * originalWidth);
                            document.getElementById('width-input').value = newWidth;
                        }
                    };
                    break;
                case 'imageEditor':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select Image to Edit</label><input type="file" id="file-upload" accept="image/*"><canvas id="image-preview-canvas" style="display:none;"></canvas><div class="form-group"><label>Brightness:</label><input type="range" class="filter-slider" data-filter="brightness" min="0" max="200" value="100"></div><div class="form-group"><label>Contrast:</label><input type="range" class="filter-slider" data-filter="contrast" min="0" max="200" value="100"></div><div class="form-group"><label>Saturation:</label><input type="range" class="filter-slider" data-filter="saturate" min="0" max="200" value="100"></div><div class="form-group"><label>Grayscale:</label><input type="range" class="filter-slider" data-filter="grayscale" min="0" max="100" value="0"></div><div class="form-group"><label>Sepia:</label><input type="range" class="filter-slider" data-filter="sepia" min="0" max="100" value="0"></div><div class="flex-group"><button id="reset-filters" class="glow-button">Reset</button><button id="download-image" class="glow-button">Download</button></div>`;
                    setupImageEditor();
                    break;
                case 'removeBg':
                    modalToolUi.innerHTML = `<p style="color:var(--text-secondary); text-align: center;">True AI background removal requires immense server-side processing power and cannot be done in the browser. This is a conceptual tool to show what's possible with a backend.</p><label class="file-upload-label">Select Image (Conceptual)</label><button class="glow-button" disabled>Remove Background</button>`;
                    break;
                // Add all other image tool cases here...
                default:
                    modalToolUi.innerHTML = `<p>This Image tool is under construction.</p>`;
            }
        }
        
        // --- Setup Functions for Tools ---
        function setupFileProcessor({ buttonId, minFiles = 1, maxFiles = Infinity, processFunction }) {
            const fileInput = document.getElementById('file-upload');
            const fileListDiv = document.getElementById('file-list');
            const processBtn = document.getElementById('process-btn');
            fileInput.onchange = () => {
                fileListDiv.innerHTML = Array.from(fileInput.files).map(f => `<p>${f.name}</p>`).join('');
                processBtn.disabled = fileInput.files.length < minFiles || fileInput.files.length > maxFiles;
            };
            processBtn.onclick = async () => {
                const originalText = processBtn.textContent;
                try {
                    processBtn.disabled = true;
                    processBtn.textContent = 'Processing...';
                    await processFunction(Array.from(fileInput.files));
                } catch (error) {
                    console.error(error);
                    showAlert(`An error occurred: ${error.message}`, 'error');
                } finally {
                    processBtn.disabled = false;
                    processBtn.textContent = originalText;
                }
            };
        }

        function setupImageProcessor({ buttonId, processFunction }) {
            const fileInput = document.getElementById('file-upload');
            const fileListDiv = document.getElementById('file-list');
            const processBtn = document.getElementById(buttonId);

            let canvas, ctx, originalFile;

            fileInput.onchange = (e) => {
                originalFile = e.target.files[0];
                if (!originalFile) return;

                fileListDiv.innerHTML = `<p>${originalFile.name}</p>`;
                processBtn.disabled = false;

                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(originalFile);
            };

            processBtn.onclick = () => {
                if (canvas && ctx && originalFile) {
                    processFunction(canvas, ctx, originalFile);
                } else {
                    showAlert('Please select an image first.', 'error');
                }
            };
        }

        function setupImageEditor() {
            const fileInput = document.getElementById('file-upload');
            const canvas = document.getElementById('image-preview-canvas');
            const ctx = canvas.getContext('2d');
            const sliders = document.querySelectorAll('.filter-slider');
            const downloadBtn = document.getElementById('download-image');
            const resetBtn = document.getElementById('reset-filters');
            let originalImage;
            
            fileInput.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    originalImage = new Image();
                    originalImage.onload = () => {
                        canvas.width = originalImage.width;
                        canvas.height = originalImage.height;
                        canvas.style.display = 'block';
                        resetFilters();
                    };
                    originalImage.src = event.target.result;
                };
                reader.readAsDataURL(file);
            };

            function applyFilters() {
                if (!originalImage) return;
                let filterString = '';
                sliders.forEach(slider => {
                    const filter = slider.dataset.filter;
                    const value = slider.value;
                    filterString += `${filter}(${value}%) `;
                });
                ctx.filter = filterString.trim();
                ctx.drawImage(originalImage, 0, 0);
            }
            
            function resetFilters() {
                sliders.forEach(slider => {
                    if (slider.dataset.filter === 'brightness' || slider.dataset.filter === 'contrast' || slider.dataset.filter === 'saturate') {
                        slider.value = 100;
                    } else {
                        slider.value = 0;
                    }
                });
                applyFilters();
            }
            
            sliders.forEach(slider => slider.addEventListener('input', applyFilters));
            resetBtn.addEventListener('click', resetFilters);
            downloadBtn.addEventListener('click', () => {
                if (!originalImage) {
                    showAlert('Please load an image first.', 'error');
                    return;
                }
                canvas.toBlob(blob => {
                    downloadFile(blob, 'wow-edited-image.png', 'image/png');
                });
            });
        }

        // --- Initial Load ---
        populateTools();
    });
    </script>
</body>
</html>
