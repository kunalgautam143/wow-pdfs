<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOW PDFs - The Ultimate PDF Tool Hub</title>
    
    <!-- REQUIRED LIBRARIES FOR PDF MANIPULATION -->
    <!-- pdf-lib: The core library for creating and modifying PDF documents -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <!-- pdf.js: Mozilla's library for rendering PDF pages (needed for PDF-to-Image and text extraction) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <!-- Sets up the worker for pdf.js to run in the background -->
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js`;</script>

    <style>
        /* CSS VARIABLES (ABHINAV PROMPT THEME) */
        :root {
            --bg-main: #0d0f14;
            --bg-navbar: #1c222d;
            --bg-card: #12151a;
            --bg-button: #1c222d;
            --accent-primary: #42f8f5;
            --accent-shade: #3ff7f3;
            --text-primary: #ffffff;
            --text-secondary: #c5d1de;
            --glow-shadow: rgba(66, 248, 245, 0.6);
            --glow-shadow-hover: rgba(66, 248, 245, 0.9);
            --border-color: #42f8f5;
            --error-color: #f84242;
        }

        /* GENERAL STYLES */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            background-color: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        /* SCROLLBAR STYLES */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-shade);
        }

        /* HEADER & NAVBAR */
        .header {
            background-color: var(--bg-navbar);
            padding: 1rem 5%;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid var(--accent-primary);
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--text-primary);
            text-shadow: 0 0 5px var(--glow-shadow);
            cursor: pointer;
        }

        .logo-accent {
            color: var(--accent-primary);
        }

        .nav-links a {
            color: var(--text-primary);
            text-decoration: none;
            margin: 0 1rem;
            font-weight: 500;
            transition: color 0.3s ease, text-shadow 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--accent-primary);
            text-shadow: 0 0 10px var(--glow-shadow);
        }
        
        .nav-toggle {
            display: none;
            font-size: 1.5rem;
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
        }

        /* MAIN CONTENT & TOOL GRID */
        .main-container {
            padding: 2rem 5%;
        }
        
        #tools {
            padding-top: 1rem;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 2rem;
            color: var(--text-primary);
            text-shadow: 0 0 10px var(--glow-shadow);
        }

        .tool-grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        /* TOOL CARD STYLING */
        .tool-card {
            background-color: var(--bg-card);
            border: 1px solid var(--bg-navbar);
            border-radius: 8px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            border-color: var(--border-color);
            box-shadow: 0 0 15px var(--glow-shadow);
        }

        .tool-card h2 {
            color: var(--accent-primary);
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .tool-card p {
            color: var(--text-secondary);
            font-size: 1rem;
            flex-grow: 1;
            margin-bottom: 1.5rem;
        }
        
        /* GENERAL BUTTON STYLES */
        .glow-button {
            background-color: var(--bg-button);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            border-radius: 5px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            text-transform: uppercase;
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 0 5px var(--glow-shadow);
            display: block;
            width: 100%;
        }

        .glow-button:hover, .glow-button:focus {
            background-color: var(--accent-primary);
            color: var(--bg-main);
            box-shadow: 0 0 20px var(--glow-shadow-hover);
        }
        .glow-button:disabled {
            cursor: not-allowed;
            background-color: #333;
            border-color: #555;
            box-shadow: none;
            color: #888;
        }

        /* MODAL STYLES */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--bg-main);
            margin: 5% auto;
            padding: 2rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 0 25px var(--glow-shadow);
            position: relative;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-close {
            color: var(--text-secondary);
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        .modal-close:hover {
            color: var(--accent-primary);
            transform: scale(1.1);
        }

        .modal-header h2 {
            color: var(--accent-primary);
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        
        .modal-body {
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        /* TOOL-SPECIFIC UI STYLES WITHIN MODAL */
        .tool-ui-container {
            margin-top: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .tool-ui-container label, .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: bold;
        }

        .tool-ui-container input[type="text"],
        .tool-ui-container input[type="number"],
        .tool-ui-container input[type="password"],
        .tool-ui-container textarea,
        .tool-ui-container select {
            width: 100%;
            padding: 0.75rem;
            background-color: var(--bg-button);
            border: 1px solid var(--bg-navbar);
            border-radius: 5px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .tool-ui-container input[type="text"]:focus,
        .tool-ui-container input[type="number"]:focus,
        .tool-ui-container input[type="password"]:focus,
        .tool-ui-container textarea:focus,
        .tool-ui-container select:focus {
            outline: none;
            border-color: var(--border-color);
            box-shadow: 0 0 8px var(--glow-shadow);
        }
        
        .tool-ui-container input[type="file"] {
            display: none;
        }
        
        .file-upload-label {
            display: block;
            padding: 2rem;
            background-color: var(--bg-button);
            border: 2px dashed var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s;
        }
        
        .file-upload-label:hover {
            background-color: var(--bg-navbar);
        }
        
        .file-list p {
            background: var(--bg-card);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin-top: 0.5rem;
        }
        
        .result-box {
            background-color: var(--bg-card);
            border: 1px solid var(--bg-navbar);
            padding: 1rem;
            border-radius: 5px;
            margin-top: 1rem;
            word-wrap: break-word;
            min-height: 50px;
        }

        .alert-message {
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 5px;
            font-weight: bold;
            display: none;
        }
        .alert-message.success {
            background-color: rgba(66, 248, 245, 0.2);
            border: 1px solid var(--accent-primary);
            color: var(--accent-primary);
        }
        .alert-message.error {
            background-color: rgba(248, 66, 66, 0.2);
            border: 1px solid var(--error-color);
            color: var(--error-color);
        }
        
        #signature-pad {
            border: 2px solid var(--border-color);
            border-radius: 5px;
            cursor: crosshair;
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem 2rem;
            }
            .nav-links {
                display: none;
                flex-direction: column;
                width: 100%;
                text-align: center;
            }
            .nav-links.active {
                display: flex;
            }
            .nav-links a {
                padding: 0.5rem 0;
                border-top: 1px solid var(--bg-button);
            }
            .nav-toggle {
                display: block;
                position: absolute;
                top: 1.25rem;
                right: 1.25rem;
            }
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>

    <!-- HEADER -->
    <header class="header">
        <div class="logo">WOW<span class="logo-accent">PDFs</span></div>
        <nav class="nav-links">
            <a href="#home">Home</a>
            <a href="#tools">Tools</a>
        </nav>
        <button class="nav-toggle" aria-label="Toggle navigation">☰</button>
    </header>

    <!-- MAIN CONTENT -->
    <main class="main-container" id="home">
        <section id="tools">
            <h1 class="section-title">The Ultimate PDF Tool Hub</h1>
            <div class="tool-grid">
                <!-- PDF Tool cards will be dynamically generated by JS -->
            </div>
        </section>
    </main>

    <!-- MODAL -->
    <div id="toolModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">×</span>
            <div class="modal-header">
                <h2 id="modal-title">Tool Title</h2>
            </div>
            <div class="modal-body">
                <div id="modal-tool-ui" class="tool-ui-container">
                    <!-- Tool-specific UI will be injected here -->
                </div>
                <div id="modal-alert" class="alert-message"></div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Core PDF Tool Definitions ---
        const tools = [
            { id: 'mergePdf', title: 'Merge PDF', description: 'Combine multiple PDF files into one single document.' },
            { id: 'splitPdf', title: 'Split PDF', description: 'Extract a range of pages or split every page into a separate PDF.' },
            { id: 'organizePdf', title: 'Organize PDF', description: 'Reorder, rotate, or delete pages from a PDF document.' },
            { id: 'imageToPdf', title: 'Image to PDF', description: 'Convert JPG, PNG, and other images into a PDF file.' },
            { id: 'pdfToJpg', title: 'PDF to JPG', description: 'Extract all images from a PDF or convert pages to JPG.' },
            { id: 'addWatermark', title: 'Add Watermark', description: 'Stamp text or an image over your PDF pages.' },
            { id: 'addPageNumbers', title: 'Add Page Numbers', description: 'Insert page numbers easily into your PDF.' },
            { id: 'rotatePdf', title: 'Rotate PDF', description: 'Rotate all or specific pages in your PDF document.' },
            { id: 'addSignature', title: 'Sign PDF', description: 'Draw your signature and add it to your PDF file.' },
            { id: 'extractText', title: 'Extract Text', description: 'Pull all text content from a PDF file into a text document.' },
            { id: 'compressPdf', title: 'Compress PDF', description: 'Reduce the file size of your PDF (Conceptual UI).' },
            { id: 'unlockPdf', title: 'Unlock PDF', description: 'Remove password security from a PDF (Conceptual UI).' },
        ];

        // --- Global Variables ---
        const toolGrid = document.querySelector('.tool-grid');
        const modal = document.getElementById('toolModal');
        const modalClose = document.querySelector('.modal-close');
        const modalTitle = document.getElementById('modal-title');
        const modalToolUi = document.getElementById('modal-tool-ui');
        const modalAlert = document.getElementById('modal-alert');
        const navToggle = document.querySelector('.nav-toggle');
        const navLinks = document.querySelector('.nav-links');

        // --- Initialize UI ---
        function populateTools() {
            toolGrid.innerHTML = '';
            tools.forEach(tool => {
                const card = document.createElement('div');
                card.className = 'tool-card';
                card.innerHTML = `
                    <h2>${tool.title}</h2>
                    <p>${tool.description}</p>
                    <button class="glow-button" data-tool-id="${tool.id}">Open Tool</button>
                `;
                toolGrid.appendChild(card);
            });
        }

        // --- Modal Handling ---
        function openModal(toolId) {
            const tool = tools.find(t => t.id === toolId);
            if (!tool) return;
            
            modalTitle.textContent = tool.title;
            modalToolUi.innerHTML = ''; // Clear previous content
            hideAlert();
            renderToolUI(toolId);
            modal.style.display = 'block';
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        function showAlert(message, type = 'success') {
            modalAlert.textContent = message;
            modalAlert.className = `alert-message ${type}`;
            modalAlert.style.display = 'block';
        }

        function hideAlert() {
            modalAlert.style.display = 'none';
        }

        // --- Event Listeners ---
        toolGrid.addEventListener('click', (e) => {
            if (e.target.classList.contains('glow-button')) {
                openModal(e.target.getAttribute('data-tool-id'));
            }
        });
        
        modalClose.addEventListener('click', closeModal);
        window.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });
        
        navToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });

        // --- Helper function for downloads ---
        function downloadFile(bytes, fileName, mimeType) {
            const blob = new Blob([bytes], { type: mimeType });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }

        // --- Tool UI Rendering Router ---
        function renderToolUI(toolId) {
            switch (toolId) {
                case 'mergePdf':
                    modalToolUi.innerHTML = `
                        <label for="file-upload" class="file-upload-label">Select PDF Files (2 or more)</label>
                        <input type="file" id="file-upload" accept=".pdf" multiple>
                        <div id="file-list" class="file-list"></div>
                        <button id="process-btn" class="glow-button" disabled>Merge PDFs</button>
                    `;
                    setupFileProcessor({
                        buttonId: 'process-btn',
                        minFiles: 2,
                        processFunction: async (files) => {
                            showAlert('Merging PDFs...', 'success');
                            const { PDFDocument } = PDFLib;
                            const mergedPdf = await PDFDocument.create();
                            for (const file of files) {
                                const pdfBytes = await file.arrayBuffer();
                                const pdfDoc = await PDFDocument.load(pdfBytes);
                                const copiedPages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
                                copiedPages.forEach(page => mergedPdf.addPage(page));
                            }
                            const mergedPdfBytes = await mergedPdf.save();
                            downloadFile(mergedPdfBytes, 'wow-pdf-merged.pdf', 'application/pdf');
                            hideAlert();
                        }
                    });
                    break;
                
                case 'splitPdf':
                     modalToolUi.innerHTML = `
                        <label for="file-upload" class="file-upload-label">Select PDF File</label>
                        <input type="file" id="file-upload" accept=".pdf">
                        <div id="file-list" class="file-list"></div>
                        <div class="form-group">
                           <label for="split-range">Page ranges to extract (e.g., 1-3, 5, 8-10):</label>
                           <input type="text" id="split-range" placeholder="Leave blank to split all pages">
                        </div>
                        <button id="process-btn" class="glow-button" disabled>Split PDF</button>
                    `;
                    setupFileProcessor({
                        buttonId: 'process-btn',
                        maxFiles: 1,
                        processFunction: async (files) => {
                            showAlert('Splitting PDF...', 'success');
                            const { PDFDocument } = PDFLib;
                            const file = files[0];
                            const pdfBytes = await file.arrayBuffer();
                            const pdfDoc = await PDFDocument.load(pdfBytes);
                            const rangeInput = document.getElementById('split-range').value.trim();

                            if (rangeInput) { // Split by range
                                const newPdfDoc = await PDFDocument.create();
                                const pagesToCopy = new Set();
                                const totalPages = pdfDoc.getPageCount();
                                rangeInput.split(',').forEach(part => {
                                    if (part.includes('-')) {
                                        const [start, end] = part.split('-').map(Number);
                                        for (let i = start; i <= end; i++) pagesToCopy.add(i - 1);
                                    } else {
                                        pagesToCopy.add(Number(part) - 1);
                                    }
                                });
                                const validPages = Array.from(pagesToCopy).filter(p => p >= 0 && p < totalPages);
                                const copiedPages = await newPdfDoc.copyPages(pdfDoc, validPages);
                                copiedPages.forEach(p => newPdfDoc.addPage(p));
                                const newPdfBytes = await newPdfDoc.save();
                                downloadFile(newPdfBytes, 'wow-pdf-split-range.pdf', 'application/pdf');
                            } else { // Split all pages
                                for (let i = 0; i < pdfDoc.getPageCount(); i++) {
                                    const newPdfDoc = await PDFDocument.create();
                                    const [copiedPage] = await newPdfDoc.copyPages(pdfDoc, [i]);
                                    newPdfDoc.addPage(copiedPage);
                                    const newPdfBytes = await newPdfDoc.save();
                                    downloadFile(newPdfBytes, `wow-pdf-page-${i + 1}.pdf`, 'application/pdf');
                                }
                            }
                            hideAlert();
                        }
                    });
                    break;

                case 'imageToPdf':
                    modalToolUi.innerHTML = `
                        <label for="file-upload" class="file-upload-label">Select Image Files (JPG, PNG)</label>
                        <input type="file" id="file-upload" accept="image/jpeg,image/png" multiple>
                        <div id="file-list" class="file-list"></div>
                        <button id="process-btn" class="glow-button" disabled>Convert to PDF</button>
                    `;
                    setupFileProcessor({
                        buttonId: 'process-btn',
                        processFunction: async (files) => {
                            showAlert('Converting images...', 'success');
                            const { PDFDocument } = PDFLib;
                            const pdfDoc = await PDFDocument.create();
                            for (const file of files) {
                                const imgBytes = await file.arrayBuffer();
                                const image = file.type === 'image/png' 
                                    ? await pdfDoc.embedPng(imgBytes) 
                                    : await pdfDoc.embedJpg(imgBytes);
                                const page = pdfDoc.addPage([image.width, image.height]);
                                page.drawImage(image, { x: 0, y: 0, width: image.width, height: image.height });
                            }
                            const pdfBytes = await pdfDoc.save();
                            downloadFile(pdfBytes, 'wow-pdf-from-images.pdf', 'application/pdf');
                            hideAlert();
                        }
                    });
                    break;
                
                case 'pdfToJpg':
                    modalToolUi.innerHTML = `
                        <label for="file-upload" class="file-upload-label">Select PDF File</label>
                        <input type="file" id="file-upload" accept=".pdf">
                        <div id="file-list" class="file-list"></div>
                        <button id="process-btn" class="glow-button" disabled>Convert Pages to JPG</button>
                    `;
                    setupFileProcessor({
                        buttonId: 'process-btn',
                        maxFiles: 1,
                        processFunction: async (files) => {
                            showAlert('Converting pages to JPG...', 'success');
                            const file = files[0];
                            const pdfBytes = await file.arrayBuffer();
                            const pdfDoc = await pdfjsLib.getDocument({data: pdfBytes}).promise;

                            for (let i = 1; i <= pdfDoc.numPages; i++) {
                                const page = await pdfDoc.getPage(i);
                                const viewport = page.getViewport({ scale: 1.5 });
                                const canvas = document.createElement('canvas');
                                const context = canvas.getContext('2d');
                                canvas.height = viewport.height;
                                canvas.width = viewport.width;

                                await page.render({ canvasContext: context, viewport: viewport }).promise;
                                canvas.toBlob(blob => {
                                    downloadFile(blob, `wow-pdf-page-${i}.jpg`, 'image/jpeg');
                                }, 'image/jpeg', 0.9);
                            }
                            setTimeout(hideAlert, 1000 * pdfDoc.numPages); // Hide alert after downloads start
                        }
                    });
                    break;
                
                case 'addSignature':
                    modalToolUi.innerHTML = `
                        <label for="file-upload" class="file-upload-label">1. Select PDF File</label>
                        <input type="file" id="file-upload" accept=".pdf">
                        <div id="file-list" class="file-list"></div>
                        <div class="form-group">
                           <label>2. Draw your signature below</label>
                           <canvas id="signature-pad" width="400" height="200"></canvas>
                           <button id="clear-signature" class="glow-button" style="width:auto; margin-top:0.5rem;">Clear</button>
                        </div>
                        <button id="process-btn" class="glow-button" disabled>Add Signature to PDF</button>
                    `;
                    setupSignatureTool();
                    break;
                
                case 'extractText':
                     modalToolUi.innerHTML = `
                        <label for="file-upload" class="file-upload-label">Select PDF File</label>
                        <input type="file" id="file-upload" accept=".pdf">
                        <div id="file-list" class="file-list"></div>
                        <button id="process-btn" class="glow-button" disabled>Extract All Text</button>
                    `;
                    setupFileProcessor({
                        buttonId: 'process-btn',
                        maxFiles: 1,
                        processFunction: async (files) => {
                            showAlert('Extracting text...', 'success');
                            const file = files[0];
                            const pdfBytes = await file.arrayBuffer();
                            const pdfDoc = await pdfjsLib.getDocument({data: pdfBytes}).promise;
                            let fullText = '';
                            for (let i = 1; i <= pdfDoc.numPages; i++) {
                                const page = await pdfDoc.getPage(i);
                                const textContent = await page.getTextContent();
                                fullText += textContent.items.map(item => item.str).join(' ') + '\n\n';
                            }
                            downloadFile(new TextEncoder().encode(fullText), 'wow-pdf-extracted-text.txt', 'text/plain');
                            hideAlert();
                        }
                    });
                    break;

                // --- Conceptual/Placeholder Tools ---
                case 'compressPdf':
                case 'unlockPdf':
                    showAlert('This is a conceptual tool. True PDF compression and unlocking are complex server-side operations.', 'success');
                    modalToolUi.innerHTML = `<p style="color:var(--text-secondary); text-align: center;">This feature requires significant server-side processing and cannot be reliably performed in the browser with simple JavaScript. This UI demonstrates how the tool would appear.</p>
                    <label for="file-upload" class="file-upload-label">Select PDF File</label>
                    <input type="file" id="file-upload" accept=".pdf" disabled>
                    <button class="glow-button" disabled>Process (Conceptual)</button>
                    `;
                    break;

                default:
                    modalToolUi.innerHTML = `<p style="color: var(--text-secondary);">This tool is under construction.</p>`;
            }
        }
        
        // --- Setup Functions for Tools ---

        // Generic file processor setup
        function setupFileProcessor({ buttonId, minFiles = 1, maxFiles = Infinity, processFunction }) {
            const fileInput = document.getElementById('file-upload');
            const fileListDiv = document.getElementById('file-list');
            const processBtn = document.getElementById('process-btn');

            fileInput.onchange = () => {
                fileListDiv.innerHTML = '';
                Array.from(fileInput.files).forEach(file => {
                    fileListDiv.innerHTML += `<p>${file.name}</p>`;
                });
                processBtn.disabled = fileInput.files.length < minFiles || fileInput.files.length > maxFiles;
            };

            processBtn.onclick = async () => {
                try {
                    processBtn.disabled = true;
                    processBtn.textContent = 'Processing...';
                    await processFunction(Array.from(fileInput.files));
                } catch (error) {
                    console.error(error);
                    showAlert(`An error occurred: ${error.message}`, 'error');
                } finally {
                    processBtn.disabled = false;
                    processBtn.textContent = tools.find(t => t.id === modal.querySelector('[data-tool-id]')?.dataset.toolId)?.title || 'Process';
                }
            };
        }
        
        // Specific setup for signature tool
        function setupSignatureTool() {
            const canvas = document.getElementById('signature-pad');
            const ctx = canvas.getContext('2d');
            let drawing = false;

            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent-primary').trim();
            ctx.lineWidth = 2;

            canvas.addEventListener('mousedown', () => { drawing = true; ctx.beginPath(); });
            canvas.addEventListener('mouseup', () => { drawing = false; });
            canvas.addEventListener('mousemove', (e) => {
                if (!drawing) return;
                const rect = canvas.getBoundingClientRect();
                ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.stroke();
            });

            document.getElementById('clear-signature').onclick = () => ctx.clearRect(0, 0, canvas.width, canvas.height);

            setupFileProcessor({
                buttonId: 'process-btn',
                maxFiles: 1,
                processFunction: async (files) => {
                    showAlert('Adding signature...', 'success');
                    const signatureImgBytes = await new Promise(resolve => canvas.toBlob(blob => {
                        const reader = new FileReader();
                        reader.onloadend = () => resolve(reader.result);
                        reader.readAsArrayBuffer(blob);
                    }, 'image/png'));
                    
                    const { PDFDocument, rgb } = PDFLib;
                    const pdfBytes = await files[0].arrayBuffer();
                    const pdfDoc = await PDFDocument.load(pdfBytes);
                    const signatureImage = await pdfDoc.embedPng(signatureImgBytes);
                    const lastPage = pdfDoc.getPage(pdfDoc.getPageCount() - 1);
                    
                    lastPage.drawImage(signatureImage, {
                        x: lastPage.getWidth() - 150, // Position top-right
                        y: 50,
                        width: 120,
                        height: 60,
                    });

                    const signedPdfBytes = await pdfDoc.save();
                    downloadFile(signedPdfBytes, 'wow-pdf-signed.pdf', 'application/pdf');
                    hideAlert();
                }
            });
        }

        // --- Initial Load ---
        populateTools();
    });
    </script>

</body>
</html>