<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WOW Tools - PDF & Image Editor</title>
    
    <!-- REQUIRED LIBRARIES -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://unpkg.com/ghostscript-wasm@1.0.12/dist/ghostscript-wasm.js"></script>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js`;
    </script>

    <style>
        :root {
            --bg-main: #0d0f14; --bg-navbar: #1c222d; --bg-card: #12151a; --bg-button: #1c222d;
            --accent-primary: #42f8f5; --accent-shade: #3ff7f3; --text-primary: #ffffff;
            --text-secondary: #c5d1de; --glow-shadow: rgba(66, 248, 245, 0.6);
            --glow-shadow-hover: rgba(66, 248, 245, 0.9); --border-color: #42f8f5; --error-color: #f84242;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; background-color: var(--bg-main); color: var(--text-primary); line-height: 1.6; }
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: var(--bg-main); }
        ::-webkit-scrollbar-thumb { background: var(--accent-primary); border-radius: 10px; }
        .header { background-color: var(--bg-navbar); padding: 1rem 5%; position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.5); border-bottom: 1px solid var(--accent-primary); }
        .logo { font-size: 1.8rem; font-weight: bold; color: var(--text-primary); text-shadow: 0 0 5px var(--glow-shadow); cursor: pointer; }
        .logo-accent { color: var(--accent-primary); }
        .nav-links a { color: var(--text-primary); text-decoration: none; margin: 0 1rem; font-weight: 500; transition: color 0.3s ease, text-shadow 0.3s ease; }
        .nav-links a:hover { color: var(--accent-primary); text-shadow: 0 0 10px var(--glow-shadow); }
        .nav-toggle { display: none; font-size: 1.5rem; background: none; border: none; color: var(--text-primary); cursor: pointer; }
        .main-container { padding: 2rem 5%; } 
        #pdf-tools, #image-tools { padding-top: 2rem; }
        .section-title { text-align: center; font-size: 2.5rem; margin: 2.5rem 0 2rem 0; color: var(--text-primary); text-shadow: 0 0 10px var(--glow-shadow); }
        .tool-grid { display: grid; gap: 1.5rem; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .tool-card { background-color: var(--bg-card); border: 1px solid var(--bg-navbar); border-radius: 8px; padding: 1.5rem; display: flex; flex-direction: column; justify-content: space-between; transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease; }
        .tool-card:hover { transform: translateY(-5px); border-color: var(--border-color); box-shadow: 0 0 15px var(--glow-shadow); }
        .tool-card h2 { color: var(--accent-primary); font-size: 1.5rem; margin-bottom: 0.5rem; }
        .tool-card p { color: var(--text-secondary); font-size: 1rem; flex-grow: 1; margin-bottom: 1.5rem; }
        .glow-button { background-color: var(--bg-button); color: var(--text-primary); border: 2px solid var(--border-color); border-radius: 5px; padding: 0.75rem 1.5rem; font-size: 1rem; font-weight: bold; cursor: pointer; text-align: center; text-transform: uppercase; transition: all 0.3s ease; box-shadow: 0 0 5px var(--glow-shadow); display: block; width: 100%; }
        .glow-button:hover, .glow-button:focus { background-color: var(--accent-primary); color: var(--bg-main); box-shadow: 0 0 20px var(--glow-shadow-hover); }
        .glow-button:disabled { cursor: not-allowed; background-color: #333; border-color: #555; box-shadow: none; color: #888; }
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(5px); }
        .modal-content { background-color: var(--bg-main); margin: 5% auto; padding: 2rem; border: 1px solid var(--border-color); border-radius: 8px; width: 90%; max-width: 800px; box-shadow: 0 0 25px var(--glow-shadow); position: relative; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .modal-close { color: var(--text-secondary); position: absolute; top: 1rem; right: 1.5rem; font-size: 2rem; font-weight: bold; cursor: pointer; transition: color 0.3s ease, transform 0.3s ease; }
        .modal-close:hover { color: var(--accent-primary); transform: scale(1.1); }
        .modal-header h2 { color: var(--accent-primary); font-size: 2rem; margin-bottom: 1rem; }
        .modal-body { max-height: 70vh; overflow-y: auto; padding-right: 10px; }
        .tool-ui-container { margin-top: 1.5rem; display: flex; flex-direction: column; gap: 1.5rem; }
        .tool-ui-container label, .form-group label { display: block; margin-bottom: 0.5rem; color: var(--text-secondary); font-weight: bold; }
        .tool-ui-container input[type="text"], .tool-ui-container input[type="number"], .tool-ui-container input[type="password"], .tool-ui-container textarea, .tool-ui-container select, .tool-ui-container input[type="color"] { width: 100%; padding: 0.75rem; background-color: var(--bg-button); border: 1px solid var(--bg-navbar); border-radius: 5px; color: var(--text-primary); font-size: 1rem; transition: border-color 0.3s, box-shadow 0.3s; }
        .tool-ui-container input:focus, .tool-ui-container textarea:focus, .tool-ui-container select:focus { outline: none; border-color: var(--border-color); box-shadow: 0 0 8px var(--glow-shadow); }
        .tool-ui-container input[type="file"] { display: none; }
        .file-upload-label { display: block; padding: 2rem; background-color: var(--bg-button); border: 2px dashed var(--border-color); border-radius: 5px; cursor: pointer; text-align: center; transition: background-color 0.3s; }
        .file-upload-label:hover { background-color: var(--bg-navbar); }
        .file-list p { background: var(--bg-card); padding: 0.5rem 1rem; border-radius: 4px; margin-top: 0.5rem; }
        .alert-message { padding: 1rem; margin-top: 1rem; border-radius: 5px; font-weight: bold; display: none; }
        .alert-message.success { background-color: rgba(66, 248, 245, 0.2); border: 1px solid var(--accent-primary); color: var(--accent-primary); }
        .alert-message.error { background-color: rgba(248, 66, 66, 0.2); border: 1px solid var(--error-color); color: var(--error-color); }
        .flex-group { display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
        #image-preview-canvas { max-width: 100%; border-radius: 5px; border: 1px solid var(--border-color); }
        #signature-pad { border: 2px solid var(--border-color); border-radius: 5px; cursor: crosshair; }
        @media (max-width: 768px) { .header { flex-direction: column; gap: 1rem; padding: 1rem 2rem; } .nav-links { display: none; flex-direction: column; width: 100%; text-align: center; } .nav-links.active { display: flex; } .nav-links a { padding: 0.5rem 0; border-top: 1px solid var(--bg-button); } .nav-toggle { display: block; position: absolute; top: 1.25rem; right: 1.25rem; } .modal-content { width: 95%; margin: 10% auto; padding: 1.5rem; } }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">WOW<span class="logo-accent">Tools</span></div>
        <nav class="nav-links">
            <a href="#pdf-tools">PDF Tools</a>
            <a href="#image-tools">Image Tools</a>
        </nav>
        <button class="nav-toggle" aria-label="Toggle navigation">☰</button>
    </header>
    
    <main class="main-container" id="home">
        <!-- PDF TOOLS SECTION -->
        <section id="pdf-tools">
            <h1 class="section-title">PDF Tool Suite</h1>
            <div class="tool-grid" id="pdf-tool-grid"></div>
        </section>

        <!-- IMAGE TOOLS SECTION -->
        <section id="image-tools">
            <h1 class="section-title">Image Tool Suite</h1>
            <div class="tool-grid" id="image-tool-grid"></div>
        </section>
    </main>
    
    <div id="toolModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">×</span>
            <div class="modal-header"><h2 id="modal-title">Tool Title</h2></div>
            <div class="modal-body">
                <div id="modal-tool-ui" class="tool-ui-container"></div>
                <div id="modal-alert" class="alert-message"></div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Tool Definitions ---
        const pdfTools = [
            { id: 'mergePdf', title: 'Merge PDF', description: 'Combine multiple PDF files into one single document.' },
            { id: 'splitPdf', title: 'Split PDF', description: 'Extract pages or split every page into a separate PDF.' },
            { id: 'compressPdf', title: 'Compress PDF', description: 'Reduce PDF file size with powerful, client-side compression.' },
            { id: 'rotatePdf', title: 'Rotate PDF', description: 'Rotate all or specific pages in your PDF document.' },
            { id: 'addWatermark', title: 'Add Watermark', description: 'Stamp text over your PDF pages with custom styling.' },
            { id: 'addPageNumbers', title: 'Add Page Numbers', description: 'Insert page numbers easily into your PDF file.' },
            { id: 'pdfToJpg', title: 'PDF to JPG', description: 'Convert PDF pages to JPG images.' },
            { id: 'addSignature', title: 'Sign PDF', description: 'Draw your signature and add it to your PDF file.' },
            { id: 'extractText', title: 'Extract Text', description: 'Pull all text content from a PDF into a text document.' },
        ];

        const imageTools = [
            { id: 'compressImage', title: 'Compress Image', description: 'Reduce the file size of JPG and PNG images.' },
            { id: 'resizeImage', title: 'Resize Image', description: 'Change the dimensions of your image.' },
            { id: 'cropImage', title: 'Crop Image', description: 'Crop images by specifying exact dimensions.' },
            { id: 'imageEditor', title: 'Photo Editor', description: 'Apply filters, adjustments, and text to your images.' },
            { id: 'watermarkImage', title: 'Watermark Image', description: 'Add a text or image watermark to your picture.' },
            { id: 'convertToJpg', title: 'Convert to JPG', description: 'Convert PNG, GIF, WebP and other formats to JPG.' },
            { id: 'removeBg', title: 'Remove Background', description: 'AI-powered background removal (Conceptual - Requires Server).'}
        ];

        const allTools = [...pdfTools, ...imageTools];

        // --- Global Variables & Initial Setup ---
        const { PDFDocument, rgb, degrees } = PDFLib;
        const pdfToolGrid = document.getElementById('pdf-tool-grid');
        const imageToolGrid = document.getElementById('image-tool-grid');
        const modal = document.getElementById('toolModal');
        const modalClose = document.querySelector('.modal-close');
        const modalTitle = document.getElementById('modal-title');
        const modalToolUi = document.getElementById('modal-tool-ui');
        const modalAlert = document.getElementById('modal-alert');
        const navToggle = document.querySelector('.nav-toggle');
        const navLinks = document.querySelector('.nav-links');
        
        function populateTools() {
            pdfToolGrid.innerHTML = '';
            imageToolGrid.innerHTML = '';

            pdfTools.forEach(tool => {
                const card = createToolCard(tool);
                pdfToolGrid.appendChild(card);
            });

            imageTools.forEach(tool => {
                const card = createToolCard(tool);
                imageToolGrid.appendChild(card);
            });
        }

        function createToolCard(tool) {
            const card = document.createElement('div');
            card.className = 'tool-card';
            card.innerHTML = `<h2>${tool.title}</h2><p>${tool.description}</p><button class="glow-button" data-tool-id="${tool.id}">Open Tool</button>`;
            return card;
        }

        function openModal(toolId) {
            const tool = allTools.find(t => t.id === toolId);
            if (!tool) return;
            modalTitle.textContent = tool.title;
            modalToolUi.innerHTML = '';
            hideAlert();
            renderToolUI(toolId);
            modal.style.display = 'block';
        }

        function closeModal() { modal.style.display = 'none'; }
        function showAlert(message, type = 'success') { modalAlert.textContent = message; modalAlert.className = `alert-message ${type}`; modalAlert.style.display = 'block'; }
        function hideAlert() { modalAlert.style.display = 'none'; }

        document.body.addEventListener('click', (e) => { 
            if (e.target.classList.contains('glow-button')) {
                const toolId = e.target.dataset.toolId;
                if (toolId) openModal(toolId);
            }
        });
        modalClose.addEventListener('click', closeModal);
        window.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
        navToggle.addEventListener('click', () => navLinks.classList.toggle('active'));

        function downloadFile(bytes, fileName, mimeType) {
            const blob = new Blob([bytes], { type: mimeType });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }
        
        function renderToolUI(toolId) {
            if (pdfTools.some(t => t.id === toolId)) {
                renderPdfTool(toolId);
            } else if (imageTools.some(t => t.id === toolId)) {
                renderImageTool(toolId);
            }
        }
        
        // --- PDF Tool Renderer ---
        function renderPdfTool(toolId) {
            switch (toolId) {
                case 'mergePdf':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select PDF Files (2 or more)</label><input type="file" id="file-upload" accept=".pdf" multiple><div id="file-list" class="file-list"></div><button id="process-btn" class="glow-button" disabled>Merge PDFs</button>`;
                    setupFileProcessor({
                        buttonId: 'process-btn', minFiles: 2, isPdf: true,
                        processFunction: async (files) => {
                            showAlert('Merging PDFs...', 'success');
                            const mergedPdf = await PDFDocument.create();
                            for (const file of files) {
                                const pdfDoc = await PDFDocument.load(await file.arrayBuffer());
                                const copiedPages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
                                copiedPages.forEach(page => mergedPdf.addPage(page));
                            }
                            downloadFile(await mergedPdf.save(), 'wow-merged.pdf', 'application/pdf');
                            hideAlert();
                        }
                    });
                    break;
                case 'splitPdf':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select PDF File</label><input type="file" id="file-upload" accept=".pdf"><div id="file-list" class="file-list"></div><div class="form-group"><label for="split-range">Page ranges (e.g., 1-3, 5, 8-10):</label><input type="text" id="split-range" placeholder="Leave blank to split all pages"></div><button id="process-btn" class="glow-button" disabled>Split PDF</button>`;
                    setupFileProcessor({
                        buttonId: 'process-btn', maxFiles: 1, isPdf: true,
                        processFunction: async (files) => {
                            showAlert('Splitting PDF...', 'success');
                            const pdfDoc = await PDFDocument.load(await files[0].arrayBuffer());
                            const rangeInput = document.getElementById('split-range').value.trim();
                            if (rangeInput) {
                                const newPdfDoc = await PDFDocument.create();
                                const pagesToCopy = new Set();
                                const totalPages = pdfDoc.getPageCount();
                                rangeInput.split(',').forEach(part => {
                                    if (part.includes('-')) { const [start, end] = part.split('-').map(Number); for (let i = start; i <= end; i++) pagesToCopy.add(i - 1); }
                                    else { pagesToCopy.add(Number(part) - 1); }
                                });
                                const copiedPages = await newPdfDoc.copyPages(pdfDoc, Array.from(pagesToCopy).filter(p => p >= 0 && p < totalPages));
                                copiedPages.forEach(p => newPdfDoc.addPage(p));
                                downloadFile(await newPdfDoc.save(), 'wow-split-range.pdf', 'application/pdf');
                            } else {
                                for (let i = 0; i < pdfDoc.getPageCount(); i++) {
                                    const newPdfDoc = await PDFDocument.create();
                                    const [copiedPage] = await newPdfDoc.copyPages(pdfDoc, [i]);
                                    newPdfDoc.addPage(copiedPage);
                                    downloadFile(await newPdfDoc.save(), `wow-page-${i + 1}.pdf`, 'application/pdf');
                                }
                            }
                            hideAlert();
                        }
                    });
                    break;
                case 'compressPdf':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select PDF File to Compress</label><input type="file" id="file-upload" accept=".pdf"><div id="file-list" class="file-list"></div><div class="form-group"><label for="compression-level">Compression Level:</label><select id="compression-level"><option value="/ebook">Recommended</option><option value="/screen">Basic (Smallest Size)</option><option value="/printer">High Quality</option></select></div><button id="process-btn" class="glow-button" disabled>Compress PDF</button>`;
                    setupFileProcessor({
                        buttonId: 'process-btn', maxFiles: 1, isPdf: true,
                        processFunction: async (files) => {
                            showAlert('Loading compression engine...', 'success');
                            const gs = await ghostscript_wasm();
                            showAlert('Engine loaded. Compressing...', 'success');
                            const inputBytes = await files[0].arrayBuffer();
                            await gs.writeFile(files[0].name, new Uint8Array(inputBytes));
                            await gs.run('-sDEVICE=pdfwrite', `-dPDFSETTINGS=${document.getElementById("compression-level").value}`, '-dNOPAUSE', '-dBATCH', '-sOutputFile=output.pdf', files[0].name);
                            const outputBytes = await gs.readFile('output.pdf');
                            downloadFile(outputBytes, `wow-compressed.pdf`, 'application/pdf');
                            hideAlert();
                            await gs.exit();
                        }
                    });
                    break;
                case 'rotatePdf':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select PDF File</label><input type="file" id="file-upload" accept=".pdf"><div id="file-list" class="file-list"></div><div class="form-group"><label for="rotation-angle">Rotation Angle:</label><select id="rotation-angle"><option value="90">90° Clockwise</option><option value="180">180°</option><option value="270">270° Clockwise</option></select></div><button id="process-btn" class="glow-button" disabled>Rotate PDF</button>`;
                    setupFileProcessor({
                        buttonId: 'process-btn', maxFiles: 1, isPdf: true,
                        processFunction: async (files) => {
                            showAlert('Rotating PDF...', 'success');
                            const angle = parseInt(document.getElementById('rotation-angle').value);
                            const pdfDoc = await PDFDocument.load(await files[0].arrayBuffer());
                            pdfDoc.getPages().forEach(page => page.setRotation(degrees(page.getRotation().angle + angle)));
                            downloadFile(await pdfDoc.save(), 'wow-rotated.pdf', 'application/pdf');
                            hideAlert();
                        }
                    });
                    break;
                case 'addWatermark':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select PDF File</label><input type="file" id="file-upload" accept=".pdf"><div id="file-list" class="file-list"></div><div class="form-group"><label for="watermark-text">Watermark Text:</label><input type="text" id="watermark-text" value="CONFIDENTIAL"></div><div class="flex-group"><div class="form-group"><label for="font-size">Font Size:</label><input type="number" id="font-size" value="72"></div><div class="form-group"><label for="opacity">Opacity (0-1):</label><input type="number" id="opacity" value="0.2" step="0.1" min="0" max="1"></div></div><button id="process-btn" class="glow-button" disabled>Add Watermark</button>`;
                    setupFileProcessor({
                        buttonId: 'process-btn', maxFiles: 1, isPdf: true,
                        processFunction: async (files) => {
                            showAlert('Adding watermark...', 'success');
                            const pdfDoc = await PDFDocument.load(await files[0].arrayBuffer());
                            const text = document.getElementById('watermark-text').value;
                            const options = {
                                size: parseInt(document.getElementById('font-size').value),
                                color: rgb(0.5, 0.5, 0.5),
                                opacity: parseFloat(document.getElementById('opacity').value),
                                rotate: degrees(45),
                            };
                            pdfDoc.getPages().forEach(page => page.drawText(text, { ...options, x: page.getWidth() / 4, y: page.getHeight() / 2 }));
                            downloadFile(await pdfDoc.save(), 'wow-watermarked.pdf', 'application/pdf');
                            hideAlert();
                        }
                    });
                    break;
                case 'addPageNumbers':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select PDF File</label><input type="file" id="file-upload" accept=".pdf"><div id="file-list" class="file-list"></div><div class="form-group"><label for="position">Position:</label><select id="position"><option value="bottom-center">Bottom Center</option><option value="bottom-right">Bottom Right</option><option value="top-center">Top Center</option><option value="top-right">Top Right</option></select></div><button id="process-btn" class="glow-button" disabled>Add Page Numbers</button>`;
                    setupFileProcessor({
                        buttonId: 'process-btn', maxFiles: 1, isPdf: true,
                        processFunction: async (files) => {
                            showAlert('Adding page numbers...', 'success');
                            const pdfDoc = await PDFDocument.load(await files[0].arrayBuffer());
                            const position = document.getElementById('position').value;
                            const pages = pdfDoc.getPages();
                            for (let i = 0; i < pages.length; i++) {
                                const { width, height } = pages[i].getSize();
                                let x, y;
                                switch(position) {
                                    case 'bottom-right': x = width - 40; y = 20; break;
                                    case 'top-center': x = width / 2; y = height - 40; break;
                                    case 'top-right': x = width - 40; y = height - 40; break;
                                    default: x = width / 2 - 10; y = 20; break;
                                }
                                pages[i].drawText(`${i + 1} / ${pages.length}`, { x, y, size: 12, color: rgb(0, 0, 0) });
                            }
                            downloadFile(await pdfDoc.save(), 'wow-numbered.pdf', 'application/pdf');
                            hideAlert();
                        }
                    });
                    break;
                case 'pdfToJpg':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select PDF File</label><input type="file" id="file-upload" accept=".pdf"><div id="file-list" class="file-list"></div><button id="process-btn" class="glow-button" disabled>Convert Pages to JPG</button>`;
                    setupFileProcessor({
                        buttonId: 'process-btn', maxFiles: 1, isPdf: true,
                        processFunction: async (files) => {
                            showAlert('Converting pages to JPG...', 'success');
                            const pdfDoc = await pdfjsLib.getDocument({data: await files[0].arrayBuffer()}).promise;
                            for (let i = 1; i <= pdfDoc.numPages; i++) {
                                const page = await pdfDoc.getPage(i);
                                const viewport = page.getViewport({ scale: 1.5 });
                                const canvas = document.createElement('canvas');
                                canvas.height = viewport.height; canvas.width = viewport.width;
                                const context = canvas.getContext('2d');
                                await page.render({ canvasContext: context, viewport: viewport }).promise;
                                canvas.toBlob(blob => downloadFile(blob, `wow-page-${i}.jpg`, 'image/jpeg'), 'image/jpeg', 0.9);
                            }
                            setTimeout(hideAlert, 500);
                        }
                    });
                    break;
                case 'addSignature':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">1. Select PDF File</label><input type="file" id="file-upload" accept=".pdf"><div id="file-list" class="file-list"></div><div class="form-group"><label>2. Draw your signature below</label><canvas id="signature-pad" width="400" height="200"></canvas><button id="clear-signature" class="glow-button" style="width:auto; margin-top:0.5rem;">Clear</button></div><button id="process-btn" class="glow-button" disabled>Add Signature to PDF</button>`;
                    setupSignatureTool();
                    break;
                case 'extractText':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select PDF File</label><input type="file" id="file-upload" accept=".pdf"><div id="file-list" class="file-list"></div><button id="process-btn" class="glow-button" disabled>Extract All Text</button>`;
                    setupFileProcessor({
                        buttonId: 'process-btn', maxFiles: 1, isPdf: true,
                        processFunction: async (files) => {
                            showAlert('Extracting text...', 'success');
                            const pdfDoc = await pdfjsLib.getDocument({data: await files[0].arrayBuffer()}).promise;
                            let fullText = '';
                            for (let i = 1; i <= pdfDoc.numPages; i++) {
                                const page = await pdfDoc.getPage(i);
                                const textContent = await page.getTextContent();
                                fullText += textContent.items.map(item => item.str).join(' ') + '\n\n';
                            }
                            downloadFile(new TextEncoder().encode(fullText), 'wow-extracted-text.txt', 'text/plain');
                            hideAlert();
                        }
                    });
                    break;
            }
        }
        
        // --- Image Tool Renderer ---
        function renderImageTool(toolId) {
            switch (toolId) {
                case 'compressImage':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select Image (JPG or PNG)</label><input type="file" id="file-upload" accept="image/jpeg,image/png"><div id="file-list" class="file-list"></div><div class="form-group"><label for="quality-slider">Quality (0-1): <span id="quality-value">0.8</span></label><input type="range" id="quality-slider" min="0.1" max="1" step="0.05" value="0.8" style="width: 100%;"></div><button id="process-btn" class="glow-button" disabled>Compress Image</button>`;
                    setupImageProcessor({
                        buttonId: 'process-btn',
                        processFunction: (canvas, file) => {
                            const quality = parseFloat(document.getElementById('quality-slider').value);
                            canvas.toBlob(blob => downloadFile(blob, `wow-compressed-${file.name}`, 'image/jpeg'), 'image/jpeg', quality);
                        }
                    });
                    document.getElementById('quality-slider').oninput = e => document.getElementById('quality-value').textContent = e.target.value;
                    break;
                case 'resizeImage':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select Image</label><input type="file" id="file-upload" accept="image/*"><div id="file-list" class="file-list"></div><div class="flex-group"><div class="form-group"><label for="width-input">New Width (px):</label><input type="number" id="width-input"></div><div class="form-group"><label for="height-input">New Height (px):</label><input type="number" id="height-input"></div></div><label><input type="checkbox" id="aspect-lock" checked> Lock aspect ratio</label><button id="process-btn" class="glow-button" disabled>Resize Image</button>`;
                    setupImageProcessor({
                        buttonId: 'process-btn',
                        onFileLoad: (img, file) => {
                            img.originalWidth = img.width;
                            img.originalHeight = img.height;
                            document.getElementById('width-input').value = img.width;
                            document.getElementById('height-input').value = img.height;
                        },
                        processFunction: (canvas, file, originalImage) => {
                            const newWidth = parseInt(document.getElementById('width-input').value);
                            const newHeight = parseInt(document.getElementById('height-input').value);
                            if (!newWidth || !newHeight) { showAlert('Please enter valid dimensions.', 'error'); return; }
                            const newCanvas = document.createElement('canvas');
                            newCanvas.width = newWidth; newCanvas.height = newHeight;
                            newCanvas.getContext('2d').drawImage(originalImage, 0, 0, newWidth, newHeight);
                            newCanvas.toBlob(blob => downloadFile(blob, `wow-resized-${file.name}`, file.type), file.type);
                        }
                    });
                    document.getElementById('width-input').oninput = (e) => {
                        const img = document.querySelector('#file-upload')._originalImage;
                        if (img && document.getElementById('aspect-lock').checked) {
                            document.getElementById('height-input').value = Math.round((e.target.value / img.originalWidth) * img.originalHeight);
                        }
                    };
                    document.getElementById('height-input').oninput = (e) => {
                        const img = document.querySelector('#file-upload')._originalImage;
                        if (img && document.getElementById('aspect-lock').checked) {
                            document.getElementById('width-input').value = Math.round((e.target.value / img.originalHeight) * img.originalWidth);
                        }
                    };
                    break;
                case 'cropImage':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select Image</label><input type="file" id="file-upload" accept="image/*"><div id="file-list" class="file-list"></div><p>Define crop area (in pixels from top-left corner):</p><div class="flex-group"><div class="form-group"><label for="crop-x">X:</label><input type="number" id="crop-x" value="0"></div><div class="form-group"><label for="crop-y">Y:</label><input type="number" id="crop-y" value="0"></div><div class="form-group"><label for="crop-w">Width:</label><input type="number" id="crop-w" value="200"></div><div class="form-group"><label for="crop-h">Height:</label><input type="number" id="crop-h" value="200"></div></div><button id="process-btn" class="glow-button" disabled>Crop Image</button>`;
                    setupImageProcessor({
                        buttonId: 'process-btn',
                        processFunction: (canvas, file, originalImage) => {
                            const x = parseInt(document.getElementById('crop-x').value);
                            const y = parseInt(document.getElementById('crop-y').value);
                            const w = parseInt(document.getElementById('crop-w').value);
                            const h = parseInt(document.getElementById('crop-h').value);
                            if (w <= 0 || h <= 0) { showAlert('Width and Height must be positive.', 'error'); return; }
                            const newCanvas = document.createElement('canvas');
                            newCanvas.width = w; newCanvas.height = h;
                            newCanvas.getContext('2d').drawImage(originalImage, x, y, w, h, 0, 0, w, h);
                            newCanvas.toBlob(blob => downloadFile(blob, `wow-cropped-${file.name}`, file.type), file.type);
                        }
                    });
                    break;
                case 'imageEditor':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select Image to Edit</label><input type="file" id="file-upload" accept="image/*"><canvas id="image-preview-canvas" style="display:none;"></canvas><div class="form-group"><label>Brightness:</label><input type="range" class="filter-slider" data-filter="brightness" min="0" max="200" value="100"></div><div class="form-group"><label>Contrast:</label><input type="range" class="filter-slider" data-filter="contrast" min="0" max="200" value="100"></div><div class="form-group"><label>Saturation:</label><input type="range" class="filter-slider" data-filter="saturate" min="0" max="200" value="100"></div><div class="form-group"><label>Grayscale:</label><input type="range" class="filter-slider" data-filter="grayscale" min="0" max="100" value="0"></div><div class="form-group"><label>Sepia:</label><input type="range" class="filter-slider" data-filter="sepia" min="0" max="100" value="0"></div><div class="flex-group"><button id="reset-filters" class="glow-button">Reset</button><button id="download-image" class="glow-button">Download</button></div>`;
                    setupImageEditor();
                    break;
                case 'watermarkImage':
                     modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select Image</label><input type="file" id="file-upload" accept="image/*"><div id="file-list" class="file-list"></div><div class="form-group"><label for="watermark-text">Watermark Text:</label><input type="text" id="watermark-text" value="WOW Tools"></div><div class="flex-group"><div class="form-group"><label for="font-size">Font Size:</label><input type="number" id="font-size" value="48"></div><div class="form-group"><label for="font-color">Color:</label><input type="color" id="font-color" value="#ffffff"></div></div><button id="process-btn" class="glow-button" disabled>Add Watermark</button>`;
                     setupImageProcessor({
                        buttonId: 'process-btn',
                        processFunction: (canvas, file, originalImage) => {
                            const ctx = canvas.getContext('2d');
                            const text = document.getElementById('watermark-text').value;
                            const size = document.getElementById('font-size').value;
                            const color = document.getElementById('font-color').value;
                            ctx.drawImage(originalImage, 0, 0);
                            ctx.font = `${size}px Arial`;
                            ctx.fillStyle = color;
                            ctx.textAlign = 'center';
                            ctx.fillText(text, canvas.width / 2, canvas.height / 2);
                            canvas.toBlob(blob => downloadFile(blob, `wow-watermarked-${file.name}`, file.type), file.type);
                        }
                     });
                     break;
                case 'convertToJpg':
                    modalToolUi.innerHTML = `<label for="file-upload" class="file-upload-label">Select Image (PNG, GIF, WebP, etc.)</label><input type="file" id="file-upload" accept="image/*"><div id="file-list" class="file-list"></div><button id="process-btn" class="glow-button" disabled>Convert to JPG</button>`;
                    setupImageProcessor({
                        buttonId: 'process-btn',
                        processFunction: (canvas, file) => {
                            const newFileName = file.name.substring(0, file.name.lastIndexOf('.')) + '.jpg';
                            canvas.toBlob(blob => downloadFile(blob, newFileName, 'image/jpeg'), 'image/jpeg', 0.95);
                        }
                    });
                    break;
                case 'removeBg':
                    modalToolUi.innerHTML = `<p style="color:var(--text-secondary); text-align: center;">True AI background removal requires immense server-side processing power and cannot be done in the browser. This is a conceptual tool to show what's possible with a backend.</p><label class="file-upload-label">Select Image (Conceptual)</label><button class="glow-button" disabled>Remove Background</button>`;
                    break;
            }
        }
        
        // --- Setup Functions ---
        function setupFileProcessor({ buttonId, minFiles = 1, maxFiles = Infinity, processFunction, isPdf = false }) {
            const fileInput = document.getElementById('file-upload');
            const fileListDiv = document.getElementById('file-list');
            const processBtn = document.getElementById(buttonId);
            fileInput.onchange = () => {
                fileListDiv.innerHTML = Array.from(fileInput.files).map(f => `<p>${f.name}</p>`).join('');
                processBtn.disabled = fileInput.files.length < minFiles || fileInput.files.length > maxFiles;
            };
            processBtn.onclick = async () => {
                const originalText = processBtn.textContent;
                try {
                    processBtn.disabled = true;
                    processBtn.textContent = 'Processing...';
                    await processFunction(Array.from(fileInput.files));
                } catch (error) {
                    console.error(error);
                    showAlert(`An error occurred: ${error.message}`, 'error');
                } finally {
                    processBtn.disabled = false;
                    processBtn.textContent = originalText;
                }
            };
        }

        function setupImageProcessor({ buttonId, onFileLoad, processFunction }) {
            const fileInput = document.getElementById('file-upload');
            const fileListDiv = document.getElementById('file-list');
            const processBtn = document.getElementById(buttonId);

            let originalImage, originalFile;

            fileInput.onchange = (e) => {
                originalFile = e.target.files[0];
                if (!originalFile) return;

                fileListDiv.innerHTML = `<p>${originalFile.name}</p>`;
                processBtn.disabled = false;

                const reader = new FileReader();
                reader.onload = (event) => {
                    originalImage = new Image();
                    originalImage.onload = () => {
                        fileInput._originalImage = originalImage; // Attach for other functions to access
                        if (onFileLoad) onFileLoad(originalImage, originalFile);
                    };
                    originalImage.src = event.target.result;
                };
                reader.readAsDataURL(originalFile);
            };

            processBtn.onclick = () => {
                if (originalImage && originalFile) {
                    const canvas = document.createElement('canvas');
                    canvas.width = originalImage.width;
                    canvas.height = originalImage.height;
                    canvas.getContext('2d').drawImage(originalImage, 0, 0);
                    processFunction(canvas, originalFile, originalImage);
                } else {
                    showAlert('Please select an image first.', 'error');
                }
            };
        }

        function setupImageEditor() {
            const fileInput = document.getElementById('file-upload');
            const canvas = document.getElementById('image-preview-canvas');
            const ctx = canvas.getContext('2d');
            const sliders = document.querySelectorAll('.filter-slider');
            const downloadBtn = document.getElementById('download-image');
            const resetBtn = document.getElementById('reset-filters');
            let originalImage;
            
            fileInput.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    originalImage = new Image();
                    originalImage.onload = () => {
                        canvas.width = originalImage.width;
                        canvas.height = originalImage.height;
                        canvas.style.display = 'block';
                        resetFilters();
                    };
                    originalImage.src = event.target.result;
                };
                reader.readAsDataURL(file);
            };

            function applyFilters() {
                if (!originalImage) return;
                let filterString = '';
                sliders.forEach(slider => {
                    const filter = slider.dataset.filter;
                    const value = slider.value;
                    let unit = '%';
                    if (filter === 'blur') unit = 'px';
                    if (filter === 'hue-rotate') unit = 'deg';
                    filterString += `${filter}(${value}${unit}) `;
                });
                ctx.filter = filterString.trim();
                ctx.drawImage(originalImage, 0, 0);
            }
            
            function resetFilters() {
                sliders.forEach(slider => {
                    if (slider.dataset.filter === 'brightness' || slider.dataset.filter === 'contrast' || slider.dataset.filter === 'saturate') slider.value = 100;
                    else slider.value = 0;
                });
                applyFilters();
            }
            
            sliders.forEach(slider => slider.addEventListener('input', applyFilters));
            resetBtn.addEventListener('click', resetFilters);
            downloadBtn.addEventListener('click', () => {
                if (!originalImage) { showAlert('Please load an image first.', 'error'); return; }
                canvas.toBlob(blob => downloadFile(blob, 'wow-edited-image.png', 'image/png'));
            });
        }
        
        function setupSignatureTool() {
            const canvas = document.getElementById('signature-pad');
            const ctx = canvas.getContext('2d');
            let drawing = false;
            ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent-primary').trim();
            ctx.lineWidth = 2;
            canvas.addEventListener('mousedown', () => { drawing = true; ctx.beginPath(); });
            canvas.addEventListener('mouseup', () => { drawing = false; });
            canvas.addEventListener('mousemove', (e) => {
                if (!drawing) return;
                const rect = canvas.getBoundingClientRect();
                ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.stroke();
            });
            document.getElementById('clear-signature').onclick = () => ctx.clearRect(0, 0, canvas.width, canvas.height);
            setupFileProcessor({
                buttonId: 'process-btn', maxFiles: 1, isPdf: true,
                processFunction: async (files) => {
                    showAlert('Adding signature...', 'success');
                    const signatureImgBytes = await new Promise(resolve => canvas.toBlob(blob => {
                        const reader = new FileReader(); reader.onloadend = () => resolve(reader.result); reader.readAsArrayBuffer(blob);
                    }, 'image/png'));
                    const pdfDoc = await PDFDocument.load(await files[0].arrayBuffer());
                    const signatureImage = await pdfDoc.embedPng(signatureImgBytes);
                    const lastPage = pdfDoc.getPage(pdfDoc.getPageCount() - 1);
                    lastPage.drawImage(signatureImage, { x: lastPage.getWidth() - 150, y: 50, width: 120, height: 60 });
                    downloadFile(await pdfDoc.save(), 'wow-signed.pdf', 'application/pdf');
                    hideAlert();
                }
            });
        }

        // --- Initial Load ---
        populateTools();
    });
    </script>
</body>
</html>
